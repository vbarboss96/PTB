<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitada Doce - Gest√£o Bakery v8</title>
    <style>
        :root { --rosa: #d63384; --dark: #2c3e50; --fundo: #f8f9fa; --danger: #e74c3c; --warning: #f1c40f; --sucesso: #28a745; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--fundo); color: #333; }
        #sidebar { width: 220px; background: var(--dark); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .logo { padding: 25px; text-align: center; font-weight: bold; background: var(--rosa); font-size: 1.1rem; }
        .nav-item { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid #3e4f5f; transition: 0.3s; font-size: 0.9rem; }
        .nav-item:hover, .nav-item.active { background: #3e4f5f; border-left: 5px solid var(--rosa); }
        #content { flex: 1; padding: 30px; overflow-y: auto; }
        .tab-content { display: none; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #eee; }
        .form-row { display: flex; gap: 12px; margin-bottom: 15px; flex-wrap: wrap; align-items: flex-end; }
        label { display: block; font-size: 0.75rem; font-weight: bold; margin-bottom: 5px; color: #666; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; padding: 12px 20px; }
        .btn-rosa { background: var(--rosa); color: white; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px; background: #f1f3f5; font-size: 0.8rem; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.85rem; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .res-card { padding: 15px; border-radius: 10px; color: white; text-align: center; }
        .bg-dark { background: var(--dark); }
        .bg-rosa { background: var(--rosa); }
        .bg-sucesso { background: var(--sucesso); }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="logo">Pitada Doce üßÅ</div>
    <div class="nav-item active" onclick="switchTab('ingredientes')">üì¶ Insumos</div>
    <div class="nav-item" onclick="switchTab('parametros')">‚öôÔ∏è Par√¢metros</div>
    <div class="nav-item" onclick="switchTab('receitas')">üéÇ Receitas</div>
</div>

<div id="content">

    <div id="tab-ingredientes" class="tab-content" style="display: block;">
        <div class="card">
            <h2>Cadastro de Insumos</h2>
            <div class="form-row">
                <div style="flex: 2;"><label>Nome</label><input type="text" id="in-nome"></div>
                <div style="flex: 1;"><label>Pre√ßo</label><input type="text" id="in-preco" oninput="maskBRL(this)"></div>
                <div style="flex: 0.5;"><label>Qtd</label><input type="text" id="in-peso"></div>
                <div style="flex: 0.5;"><label>Unid</label>
                    <select id="in-unid"><option value="g">g</option><option value="Kg">Kg</option><option value="un">un</option><option value="ML">ML</option><option value="L">L</option></select>
                </div>
            </div>
            <button class="btn-rosa" onclick="handleSave()">üíæ SALVAR INSUMO</button>
        </div>
        <div class="card">
            <input type="text" id="search-ing" placeholder="üîé Pesquisar..." oninput="renderIngs()" style="margin-bottom:15px">
            <table id="table-ing">
                <thead><tr><th>Nome</th><th>Custo</th><th>Medida</th><th>A√ß√£o</th></tr></thead>
                <tbody id="lista-corpo"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-parametros" class="tab-content">
        <div class="card">
            <h2>‚öôÔ∏è Configura√ß√µes Globais</h2>
            <div class="form-row">
                <div style="flex: 1;"><label>% Quebra M√©dio</label><input type="number" id="p-quebra" step="0.01"></div>
                <div style="flex: 1;"><label>% Despesas Gerais</label><input type="number" id="p-despesas" step="0.01"></div>
                <div style="flex: 1;"><label>Fator de Lucro (Markup)</label><input type="number" id="p-markup" step="0.1"></div>
            </div>
            <button class="btn-rosa" onclick="saveParams()">üíæ SALVAR PAR√ÇMETROS</button>
        </div>
        <div class="card">
            <p style="font-size: 0.8rem; color: #666;">* Esses valores ser√£o usados como sugest√£o padr√£o na cria√ß√£o de novas receitas.</p>
        </div>
    </div>

    <div id="tab-receitas" class="tab-content">
        <div class="card">
            <h2>üéÇ Ficha T√©cnica: Bolo de Coco</h2>
            <div class="form-row" style="background: #fdf2f7; padding: 15px; border-radius: 8px;">
                <div style="flex: 1;"><label>Rendimento (unid)</label><input type="number" id="rec-renda" value="10"></div>
                <div style="flex: 1;"><label>% Quebra</label><input type="number" id="rec-quebra"></div>
                <div style="flex: 1;"><label>% Despesas</label><input type="number" id="rec-despesa"></div>
                <div style="flex: 1;"><label>Fator Lucro</label><input type="number" id="rec-markup"></div>
            </div>

            <div class="form-row" style="margin-top:20px">
                <div style="flex: 2;"><label>Ingrediente</label><select id="rec-drop"></select></div>
                <div style="flex: 1;"><label>Qtd Usada</label><input type="text" id="rec-qtd-usada"></div>
                <div style="flex: 0.5;"><button style="background: var(--dark); color:white; width:100%" onclick="addToRecipe()">+ ADD</button></div>
            </div>

            <table>
                <thead><tr><th>Item</th><th>Uso</th><th>Custo</th><th>X</th></tr></thead>
                <tbody id="rec-list"></tbody>
            </table>

            <div class="result-grid">
                <div class="res-card bg-dark">Custo Insumos<br><b id="res-insumos">R$ 0,00</b></div>
                <div class="res-card bg-dark">Custo c/ Taxas<br><b id="res-taxas">R$ 0,00</b></div>
                <div class="res-card bg-rosa">Custo Unit√°rio<br><b id="res-unit">R$ 0,00</b></div>
                <div class="res-card bg-sucesso">Venda Recomendada<br><b id="res-venda">R$ 0,00</b></div>
            </div>
        </div>
    </div>

</div>

<script>
    // LISTA ORIGINAL (53 ITENS)
    const baseFinal = [{"nome":"A√ß√∫car Cristal","preco":5.49,"peso":1.0,"unid":"Kg"},{"nome":"A√ß√∫car Refinado","preco":4.99,"peso":1.0,"unid":"Kg"},{"nome":"Chocolate ao leite Sicao","preco":164.99,"peso":2.005,"unid":"Kg"},{"nome":"Creme de Leite","preco":4.19,"peso":200.0,"unid":"g"},{"nome":"Manteiga","preco":14.99,"peso":200.0,"unid":"g"},{"nome":"Ovos","preco":25.0,"peso":30.0,"unid":"un"},{"nome":"Nutella","preco":190.0,"peso":3.0,"unid":"Kg"}];

    let db = JSON.parse(localStorage.getItem('pd_db_v8')) || baseFinal;
    let params = JSON.parse(localStorage.getItem('pd_params')) || { quebra: 10, despesas: 15, markup: 2.1 };
    let recipeItems = [];

    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + tab).style.display = 'block';
        event.currentTarget.classList.add('active');
        if(tab === 'receitas') loadRecipeFields();
        renderIngs();
    }

    function loadRecipeFields() {
        document.getElementById('rec-quebra').value = params.quebra;
        document.getElementById('rec-despesa').value = params.despesas;
        document.getElementById('rec-markup').value = params.markup;
    }

    function saveParams() {
        params = {
            quebra: parseFloat(document.getElementById('p-quebra').value),
            despesas: parseFloat(document.getElementById('p-despesas').value),
            markup: parseFloat(document.getElementById('p-markup').value)
        };
        localStorage.setItem('pd_params', JSON.stringify(params));
        alert("Par√¢metros globais salvos!");
    }

    function maskBRL(i) {
        let v = i.value.replace(/\D/g,'');
        v = (v/100).toFixed(2).replace(".", ",");
        i.value = "R$ " + v;
    }

    function parseNum(v) { return parseFloat(v.toString().replace(",", ".")) || 0; }
    function parseBRL(v) { return parseFloat(v.replace(/[R$\s.]/g, "").replace(",", ".")) || 0; }

    function handleSave() {
        const nome = document.getElementById('in-nome').value;
        const preco = parseBRL(document.getElementById('in-preco').value);
        const peso = parseNum(document.getElementById('in-peso').value);
        const unid = document.getElementById('in-unid').value;
        db.push({ nome, preco, peso, unid });
        localStorage.setItem('pd_db_v8', JSON.stringify(db));
        renderIngs();
    }

    function renderIngs() {
        const corpo = document.getElementById('lista-corpo');
        const drop = document.getElementById('rec-drop');
        corpo.innerHTML = "";
        drop.innerHTML = '<option value="">-- Selecione --</option>';
        db.sort((a,b) => a.nome.localeCompare(b.nome)).forEach((it, idx) => {
            corpo.innerHTML += `<tr><td>${it.nome}</td><td>R$ ${it.preco.toFixed(2)}</td><td>${it.peso}${it.unid}</td><td><button onclick="db.splice(${idx},1);renderIngs()" style="color:red">X</button></td></tr>`;
            drop.innerHTML += `<option value="${idx}">${it.nome}</option>`;
        });
    }

    function addToRecipe() {
        const idx = document.getElementById('rec-drop').value;
        const qtd = parseNum(document.getElementById('rec-qtd-usada').value);
        if(idx === "" || qtd <= 0) return;
        const it = db[idx];
        let divisor = it.peso;
        if((it.unid === "Kg" || it.unid === "L") && qtd >= 10) divisor = it.peso * 1000;
        const custo = (it.preco / divisor) * qtd;
        recipeItems.push({ nome: it.nome, custo: custo, qtd: qtd, unid: it.unid });
        calculateTotal();
    }

    function calculateTotal() {
        const rendimento = parseNum(document.getElementById('rec-renda').value) || 1;
        const quebraPerc = parseNum(document.getElementById('rec-quebra').value) / 100;
        const despesaPerc = parseNum(document.getElementById('rec-despesa').value) / 100;
        const markup = parseNum(document.getElementById('rec-markup').value);

        let custoInsumos = recipeItems.reduce((acc, it) => acc + it.custo, 0);
        let custoComQuebra = custoInsumos * (1 + quebraPerc);
        let custoTotalFinal = custoComQuebra * (1 + despesaPerc);
        let custoUnitario = custoTotalFinal / rendimento;
        let precoVenda = custoUnitario * markup;

        // Render Tabela
        const lista = document.getElementById('rec-list');
        lista.innerHTML = "";
        recipeItems.forEach((it, i) => {
            lista.innerHTML += `<tr><td>${it.nome}</td><td>${it.qtd}${it.unid}</td><td>R$ ${it.custo.toFixed(2)}</td><td onclick="recipeItems.splice(${i},1);calculateTotal()" style="color:red;cursor:pointer">‚úñ</td></tr>`;
        });

        // Atualizar Cards
        document.getElementById('res-insumos').innerText = "R$ " + custoInsumos.toFixed(2);
        document.getElementById('res-taxas').innerText = "R$ " + custoTotalFinal.toFixed(2);
        document.getElementById('res-unit').innerText = "R$ " + custoUnitario.toFixed(2);
        document.getElementById('res-venda').innerText = "R$ " + precoVenda.toFixed(2);
    }

    // Init
    document.getElementById('p-quebra').value = params.quebra;
    document.getElementById('p-despesas').value = params.despesas;
    document.getElementById('p-markup').value = params.markup;
    renderIngs();
</script>
</body>
</html>
