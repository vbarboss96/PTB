<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Pitada Doce - AI Agent </title>
    <style>
        :root { --rosa: #d63384; --dark: #2c3e50; --fundo: #f8f9fa; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--fundo); }
        
        /* Menu Lateral Corrigido */
        #sidebar { width: 220px; background: var(--dark); color: white; display: flex; flex-direction: column; }
        .logo { padding: 25px; text-align: center; font-weight: bold; background: var(--rosa); font-size: 1.2rem; }
        .nav-item { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid #3e4f5f; transition: 0.2s; }
        .nav-item:hover { background: #3e4f5f; border-left: 5px solid var(--rosa); }
        .nav-item.active { background: #3e4f5f; border-left: 5px solid var(--rosa); }

        /* √Årea de Conte√∫do */
        #content { flex: 1; padding: 30px; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Estilos de Cart√£o */
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #eee; }
        h2 { color: var(--dark); margin-top: 0; font-size: 1.3rem; border-bottom: 2px solid var(--fundo); padding-bottom: 10px; }
        
        /* Formul√°rios */
        .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .field { flex: 1; min-width: 120px; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #666; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        /* Bot√µes */
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-add { background: var(--rosa); color: white; padding: 12px 25px; width: 100%; }
        .btn-edit { background: #f1c40f; color: #000; padding: 6px 12px; font-size: 0.75rem; }
        .btn-del { background: #e74c3c; color: white; padding: 6px 12px; font-size: 0.75rem; margin-left: 5px; }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; padding: 12px; background: #f1f3f5; color: #495057; border-bottom: 2px solid #dee2e6; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        
        .total-box { background: var(--dark); color: white; padding: 25px; border-radius: 12px; text-align: right; margin-top: 20px; }
        .total-box span { font-size: 1.8rem; color: var(--rosa); margin-left: 15px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="logo">Pitada Doce üßÅ</div>
    <div class="nav-item active" id="menu-ing" onclick="switchTab('ingredientes')">üì¶ Ingredientes</div>
    <div class="nav-item" id="menu-rec" onclick="switchTab('receitas')">üéÇ Receitas</div>
</div>

<div id="content">

    <div id="tab-ingredientes" class="tab-content active">
        <div class="card">
            <h2 id="form-title">Cadastrar Novo Ingrediente</h2>
            <input type="hidden" id="edit-id" value="-1">
            <div class="form-row">
                <div style="flex: 2;">
                    <label>Nome do Insumo</label>
                    <input type="text" id="in-nome" placeholder="Ex: Leite Condensado">
                </div>
                <div style="flex: 1.2;">
                    <label>Valor Pago</label>
                    <input type="text" id="in-preco" placeholder="R$ 0,00" oninput="maskBRL(this)">
                </div>
                <div style="flex: 0.8;">
                    <label>Peso/Qtd</label>
                    <input type="number" id="in-peso" placeholder="395">
                </div>
                <div style="flex: 0.8;">
                    <label>Unidade</label>
                    <select id="in-unid">
                        <option value="g">g</option>
                        <option value="Kg">Kg</option>
                        <option value="ML">ML</option>
                        <option value="L">L</option>
                        <option value="un">un</option>
                    </select>
                </div>
            </div>
            <button class="btn-add" id="btn-save" onclick="handleSave()">üíæ Salvar </button>
            <button id="btn-cancel" style="display:none; width:100%; margin-top:10px; padding:10px;" onclick="resetForm()">Cancelar Edi√ß√£o</button>
        </div>

        <div class="card">
            <h2>Lista de Insumos Salvos</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ingrediente</th>
                        <th>Pre√ßo</th>
                        <th>Medida</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="lista-corpo"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-receitas" class="tab-content">
        <div class="card">
            <h2>Calculadora de Receita</h2>
            <div class="form-row">
                <div style="flex: 2;">
                    <label>Selecione o Ingrediente</label>
                    <select id="rec-drop"></select>
                </div>
                <div style="flex: 1;">
                    <label>Quantidade Usada</label>
                    <input type="number" id="rec-qtd-usada" placeholder="Ex: 200">
                </div>
                <div style="flex: 0.5; align-self: flex-end;">
                    <button class="btn-add" style="background: var(--dark); padding: 12px;" onclick="addToRecipe()">+ ADD</button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Uso</th>
                        <th>Custo</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="rec-list"></tbody>
            </table>

            <div class="total-box">Custo Total da Receita: <span id="rec-total">R$ 0,00</span></div>
            <button onclick="clearRecipe()" style="background:none; color: #999; margin-top:10px;">Limpar tudo</button>
        </div>
    </div>

</div>

<script>
    // BASE DE DADOS INICIAL (Extra√≠da da sua planilha)
    const baseIncial = [{"nome": "A√ß√∫car Cristal", "preco": 5.49, "peso": 1000, "unid": "g"}, {"nome": "Chocolate Melken Meio Amargo", "preco": 159.99, "peso": 2005, "unid": "g"}, {"nome": "Leite condensado", "preco": 9.99, "peso": 395, "unid": "g"}, {"nome": "Manteiga", "preco": 14.99, "peso": 200, "unid": "g"}, {"nome": "Ovos", "preco": 25.00, "peso": 30, "unid": "un"}];

    let db = JSON.parse(localStorage.getItem('pitadaData')) || baseIncial;
    let currentRecipe = [];

    // Navega√ß√£o
    function switchTab(tab) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(m => m.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');
        if(tab === 'ingredientes') document.getElementById('menu-ing').classList.add('active');
        else document.getElementById('menu-rec').classList.add('active');
    }

    // M√°scara R$
    function maskBRL(i) {
        let v = i.value.replace(/\D/g,'');
        v = (v/100).toFixed(2) + '';
        v = v.replace(".", ",");
        v = v.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
        v = v.replace(/(\d)(\d{3}),/g, "$1.$2,");
        i.value = "R$ " + v;
    }

    function parseBRL(v) {
        return parseFloat(v.replace(/[R$\s.]/g, "").replace(",", ".")) || 0;
    }

    // CRUD
    function handleSave() {
        const nome = document.getElementById('in-nome').value;
        const preco = parseBRL(document.getElementById('in-preco').value);
        const peso = parseFloat(document.getElementById('in-peso').value);
        const unid = document.getElementById('in-unid').value;
        const editId = parseInt(document.getElementById('edit-id').value);

        if(!nome || preco <= 0 || !peso) return alert("Preencha todos os dados!");

        if(editId > -1) {
            if(confirm("Confirmar edi√ß√£o de " + nome + "?")) {
                db[editId] = { nome, preco, peso, unid };
            }
        } else {
            db.push({ nome, preco, peso, unid });
        }

        saveAndRefresh();
        resetForm();
    }

    function saveAndRefresh() {
        localStorage.setItem('pitadaData', JSON.stringify(db));
        renderIngs();
    }

    function renderIngs() {
        const corpo = document.getElementById('lista-corpo');
        const drop = document.getElementById('rec-drop');
        corpo.innerHTML = "";
        drop.innerHTML = '<option value="">-- Escolha um Insumo --</option>';

        db.sort((a,b) => a.nome.localeCompare(b.nome)).forEach((item, i) => {
            corpo.innerHTML += `<tr>
                <td><b>${item.nome}</b></td>
                <td>R$ ${item.preco.toFixed(2)}</td>
                <td>${item.peso}${item.unid}</td>
                <td>
                    <button class="btn-edit" onclick="startEdit(${i})">Editar</button>
                    <button class="btn-del" onclick="handleDelete(${i})">Excluir</button>
                </td>
            </tr>`;
            drop.innerHTML += `<option value="${i}">${item.nome}</option>`;
        });
    }

    function handleDelete(i) {
        if(confirm("Deseja DELETAR o ingrediente " + db[i].nome + "? Esta a√ß√£o n√£o pode ser desfeita.")) {
            db.splice(i, 1);
            saveAndRefresh();
        }
    }

    function startEdit(i) {
        const item = db[i];
        document.getElementById('edit-id').value = i;
        document.getElementById('in-nome').value = item.nome;
        document.getElementById('in-preco').value = "R$ " + item.preco.toFixed(2).replace(".",",");
        document.getElementById('in-peso').value = item.peso;
        document.getElementById('in-unid').value = item.unid;
        document.getElementById('form-title').innerText = "üìù Editando: " + item.nome;
        document.getElementById('btn-save').innerText = "ATUALIZAR INGREDIENTE";
        document.getElementById('btn-cancel').style.display = "block";
        window.scrollTo(0,0);
    }

    function resetForm() {
        document.getElementById('edit-id').value = "-1";
        document.getElementById('in-nome').value = "";
        document.getElementById('in-preco').value = "";
        document.getElementById('in-peso').value = "";
        document.getElementById('form-title').innerText = "Cadastrar Novo Ingrediente";
        document.getElementById('btn-save').innerText = "üíæ SALVAR NO BANCO DE DADOS";
        document.getElementById('btn-cancel').style.display = "none";
    }

    // Receita
    function addToRecipe() {
        const idx = document.getElementById('rec-drop').value;
        const qtd = parseFloat(document.getElementById('rec-qtd-usada').value);
        if(idx === "" || !qtd) return;

        const item = db[idx];
        let divisor = item.peso;
        if(item.unid === "Kg" || item.unid === "L") divisor = item.peso * 1000;

        const custo = (item.preco / divisor) * qtd;
        currentRecipe.push({ nome: item.nome, qtd, custo });
        renderRecipe();
        document.getElementById('rec-qtd-usada').value = "";
    }

    function renderRecipe() {
        const corpo = document.getElementById('rec-list');
        corpo.innerHTML = "";
        let total = 0;
        currentRecipe.forEach((it, i) => {
            total += it.custo;
            corpo.innerHTML += `<tr>
                <td>${it.nome}</td>
                <td>${it.qtd}</td>
                <td>R$ ${it.custo.toFixed(2)}</td>
                <td onclick="currentRecipe.splice(${i},1);renderRecipe()" style="color:red; cursor:pointer;">‚úñÔ∏è</td>
            </tr>`;
        });
        document.getElementById('rec-total').innerText = "R$ " + total.toFixed(2);
    }

    function clearRecipe() { currentRecipe = []; renderRecipe(); }

    // Init
    renderIngs();
</script>
</body>
</html>
