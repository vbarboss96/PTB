<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Pitada Doce Bakery</title>
    <style>
        :root { --rosa: #d63384; --rosa-claro: #fcf4f7; --dark: #343a40; --azul: #0d6efd; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: #f4f4f4; }
        
        /* Menu Lateral */
        #sidebar { width: 250px; background: var(--dark); color: white; transition: 0.3s; overflow: hidden; }
        #sidebar.collapsed { width: 60px; }
        .nav-item { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; border-bottom: 1px solid #444; }
        .nav-item:hover { background: var(--rosa); }
        .nav-item span { margin-left: 10px; }
        #sidebar.collapsed span { display: none; }

        /* √Årea Principal */
        #main-content { flex: 1; padding: 20px; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Estilos de Cart√£o e Form */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { color: var(--rosa); border-bottom: 2px solid var(--rosa-claro); padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; font-size: 0.85rem; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .row { display: flex; gap: 10px; }
        
        button { border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-main { background: var(--rosa); color: white; width: 100%; }
        .btn-edit { background: #ffc107; color: #222; padding: 5px 10px; font-size: 0.8rem; }
        .btn-del { background: #dc3545; color: white; padding: 5px 10px; font-size: 0.8rem; }

        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; font-size: 0.9rem; }
        th { background: var(--rosa-claro); text-align: left; padding: 12px; color: var(--rosa); }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .total-box { background: var(--dark); color: white; padding: 20px; border-radius: 12px; text-align: right; font-size: 1.3rem; margin-top: 20px; }
    </style>
</head>
<body>

<div id="sidebar">
    <div style="padding: 20px; text-align: center; font-weight: bold; border-bottom: 2px solid var(--rosa);">üßÅ Pitada Doce</div>
    <div class="nav-item" onclick="showTab('tab-ingredientes')">üì¶ <span>Ingredientes</span></div>
    <div class="nav-item" onclick="showTab('tab-receitas')">üéÇ <span>Receitas</span></div>
    <div class="nav-item" style="background: #222;" onclick="toggleSidebar()">‚ÜîÔ∏è <span>Recolher Menu</span></div>
</div>

<div id="main-content">
    
    <div id="tab-ingredientes" class="tab-content active">
        <div class="card" id="form-ingrediente">
            <h2 id="titulo-form">üì¶ Novo Ingrediente</h2>
            <input type="hidden" id="edit-index" value="-1">
            <div class="form-group">
                <label>Nome do Insumo</label>
                <input type="text" id="ing-nome" placeholder="Ex: Chocolate Melken">
            </div>
            <div class="row">
                <div style="flex: 2;">
                    <label>Pre√ßo de Compra</label>
                    <input type="text" id="ing-preco" placeholder="R$ 0,00" oninput="maskMoney(this)">
                </div>
                <div style="flex: 1;">
                    <label>Peso/Qtd</label>
                    <input type="number" id="ing-qtd" placeholder="1000">
                </div>
                <div style="flex: 1;">
                    <label>Unidade</label>
                    <select id="ing-unidade">
                        <option value="g">Grama (g)</option>
                        <option value="Kg">Kg (Kilo)</option>
                        <option value="ML">ML</option>
                        <option value="L">Litro (L)</option>
                        <option value="Mg">Miligrama (Mg)</option>
                    </select>
                </div>
            </div>
            <button class="btn-main" id="btn-salvar" onclick="salvarIngrediente()">üíæ SALVAR INGREDIENTE</button>
            <button class="btn-main" id="btn-cancelar" style="background: #6c757d; margin-top: 5px; display: none;" onclick="cancelarEdicao()">Cancelar</button>
        </div>

        <div class="card">
            <button onclick="importarBase()" style="background: var(--azul); color: white; margin-bottom: 15px; width: auto;">üì• Importar Lista da Planilha</button>
            <table>
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Pre√ßo</th>
                        <th>Medida</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="lista-ingredientes"></tbody>
            </table>
        </div>
    </div>

    <div id="tab-receitas" class="tab-content">
        <div class="card">
            <h2>üéÇ Montar Nova Receita</h2>
            <div class="row">
                <div style="flex: 2;">
                    <label>Escolher Ingrediente</label>
                    <select id="drop-ingredientes"><option>Carregue os ingredientes...</option></select>
                </div>
                <div style="flex: 1;">
                    <label>Qtd. Usada</label>
                    <input type="number" id="rec-qtd" placeholder="Ex: 200">
                </div>
                <div style="flex: 1; align-self: flex-end;">
                    <button class="btn-main" style="background: var(--dark);" onclick="addNaReceita()">+ ADD</button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Qtd Usada</th>
                        <th>Subtotal</th>
                        <th>A√ß√£o</th>
                    </tr>
                </thead>
                <tbody id="corpo-receita"></tbody>
            </table>

            <div class="total-box" id="total-receita">Custo Total: R$ 0,00</div>
            <button onclick="limparReceita()" style="background: transparent; color: var(--dark); border: 1px solid var(--dark); margin-top: 10px;">Limpar Receita</button>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('pitadaDB_v2')) || [];
    let receitaAtiva = [];

    // L√≥gica de Abas
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('collapsed');
    }

    // M√°scara de Moeda
    function maskMoney(i) {
        let v = i.value.replace(/\D/g,'');
        v = (v/100).toFixed(2) + '';
        v = v.replace(".", ",");
        v = v.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
        v = v.replace(/(\d)(\d{3}),/g, "$1.$2,");
        i.value = "R$ " + v;
    }

    function parseMoney(v) {
        return parseFloat(v.replace(/[R$\s.]/g, "").replace(",", ".")) || 0;
    }

    // CRUD Ingredientes
    function salvarIngrediente() {
        const nome = document.getElementById('ing-nome').value;
        const preco = parseMoney(document.getElementById('ing-preco').value);
        const qtd = parseFloat(document.getElementById('ing-qtd').value);
        const unidade = document.getElementById('ing-unidade').value;
        const editIndex = parseInt(document.getElementById('edit-index').value);

        if(!nome || preco <= 0 || !qtd) return alert("Preencha todos os campos!");

        if(editIndex > -1) {
            if(!confirm(`Deseja salvar as altera√ß√µes em "${nome}"?`)) return;
            db[editIndex] = { nome, preco, qtd, unidade };
        } else {
            db.push({ nome, preco, qtd, unidade });
        }

        localStorage.setItem('pitadaDB_v2', JSON.stringify(db));
        cancelarEdicao();
        renderIngredientes();
    }

    function renderIngredientes() {
        const lista = document.getElementById('lista-ingredientes');
        const drop = document.getElementById('drop-ingredientes');
        lista.innerHTML = "";
        drop.innerHTML = '<option value="">-- Selecione --</option>';

        db.sort((a,b) => a.nome.localeCompare(b.nome)).forEach((item, i) => {
            lista.innerHTML += `
                <tr>
                    <td>${item.nome}</td>
                    <td>R$ ${item.preco.toFixed(2)}</td>
                    <td>${item.qtd}${item.unidade}</td>
                    <td>
                        <button class="btn-edit" onclick="prepararEdicao(${i})">Editar</button>
                        <button class="btn-del" onclick="deletarIngrediente(${i})">X</button>
                    </td>
                </tr>`;
            
            drop.innerHTML += `<option value="${i}">${item.nome}</option>`;
        });
    }

    function deletarIngrediente(i) {
        if(confirm(`TEM CERTEZA que deseja excluir o ingrediente "${db[i].nome}"?`)) {
            db.splice(i, 1);
            localStorage.setItem('pitadaDB_v2', JSON.stringify(db));
            renderIngredientes();
        }
    }

    function prepararEdicao(i) {
        const item = db[i];
        document.getElementById('titulo-form').innerText = "üìù Editando: " + item.nome;
        document.getElementById('ing-nome').value = item.nome;
        document.getElementById('ing-preco').value = "R$ " + item.preco.toFixed(2).replace(".",",");
        document.getElementById('ing-qtd').value = item.qtd;
        document.getElementById('ing-unidade').value = item.unidade;
        document.getElementById
