<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitada Doce Bakery - Final</title>
    <style>
        :root { --rosa: #d63384; --dark: #2c3e50; --fundo: #f8f9fa; --danger: #e74c3c; }
        body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; background: var(--fundo); }
        #sidebar { width: 220px; background: var(--dark); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .logo { padding: 25px; text-align: center; font-weight: bold; background: var(--rosa); font-size: 1.1rem; }
        .nav-item { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid #3e4f5f; transition: 0.3s; }
        .nav-item:hover, .nav-item.active { background: #3e4f5f; border-left: 5px solid var(--rosa); }
        #content { flex: 1; padding: 20px; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .form-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        button { cursor: pointer; border: none; border-radius: 5px; font-weight: bold; padding: 10px 15px; }
        .btn-rosa { background: var(--rosa); color: white; width: 100%; padding: 15px; font-size: 1rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th { text-align: left; padding: 10px; background: #eee; }
        td { padding: 10px; border-bottom: 1px solid #eee; }
        .total-box { background: var(--dark); color: white; padding: 20px; border-radius: 10px; text-align: right; margin-top: 20px; font-size: 1.2rem; }
        .total-box b { color: var(--rosa); font-size: 1.8rem; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="logo">Pitada Doce üßÅ</div>
    <div class="nav-item active" onclick="showTab('ingredientes', this)">üì¶ Ingredientes</div>
    <div class="nav-item" onclick="showTab('receitas', this)">üéÇ Receitas</div>
</div>

<div id="content">
    <div id="tab-ingredientes" class="tab-content active">
        <div class="card">
            <h2>Gerenciar Insumos</h2>
            <div class="form-row">
                <input type="text" id="in-nome" placeholder="Nome" style="flex:2">
                <input type="text" id="in-preco" placeholder="R$ 0,00" oninput="maskMoney(this)" style="flex:1">
                <input type="text" id="in-peso" placeholder="Peso" style="flex:0.8">
                <select id="in-unid" style="flex:0.8">
                    <option value="g">g</option><option value="Kg">Kg</option>
                    <option value="ML">ML</option><option value="L">L</option>
                    <option value="un">un</option>
                </select>
            </div>
            <button class="btn-rosa" onclick="saveIng()">üíæ SALVAR INGREDIENTE</button>
        </div>

        <div class="card">
            <input type="text" id="search" placeholder="üîé Pesquisar..." oninput="renderIngs()" style="width:100%; margin-bottom:10px">
            <table>
                <thead><tr><th>Nome</th><th>Pre√ßo</th><th>Medida</th><th>A√ß√£o</th></tr></thead>
                <tbody id="lista-ing"></tbody>
            </table>
            <button onclick="resetSystem()" style="background:#0d6efd; color:white; width:100%; margin-top:20px">üîÑ RESETAR SISTEMA (Limpar erros e carregar lista)</button>
        </div>
    </div>

    <div id="tab-receitas" class="tab-content">
        <div class="card">
            <h2>Calculadora</h2>
            <div class="form-row">
                <select id="drop-ing" onchange="updateUnit()" style="flex:2"></select>
                <input type="text" id="rec-qtd" placeholder="Qtd" style="flex:1">
                <button style="background:var(--dark); color:white" onclick="addToRecipe()">+ ADD</button>
            </div>
            <p id="label-unidade" style="font-size:0.8rem; color:var(--rosa); font-weight:bold; margin:0">Unidade: ---</p>
            <table>
                <thead><tr><th>Item</th><th>Qtd</th><th>Custo</th><th>X</th></tr></thead>
                <tbody id="lista-rec"></tbody>
            </table>
            <div class="total-box">Custo Total: <b id="total-rec">R$ 0,00</b></div>
        </div>
    </div>
</div>

<script>
    const inicial = [{"nome":"A√ß√∫car Cristal","preco":5.49,"peso":1,"unid":"Kg"},{"nome":"A√ß√∫car Refinado","preco":4.99,"peso":1,"unid":"Kg"},{"nome":"Canela em p√≥","preco":4.99,"peso":30,"unid":"g"},{"nome":"Chocolate Melken Meio Amargo","preco":159.99,"peso":2.005,"unid":"Kg"},{"nome":"Creme de Leite","preco":4.19,"peso":200,"unid":"g"},{"nome":"Doce de Leite Frimesa","preco":10.89,"peso":400,"unid":"g"},{"nome":"Farinha de Trigo","preco":6.99,"peso":1,"unid":"Kg"},{"nome":"Ovos","preco":25.00,"peso":30,"unid":"un"},{"nome":"Manteiga","preco":14.99,"peso":200,"unid":"g"},{"nome":"Leite condensado","preco":9.99,"peso":395,"unid":"g"},{"nome":"Colher descartavel","preco":29.90,"peso":50,"unid":"un"}];

    let db = JSON.parse(localStorage.getItem('pitadaFinalDB')) || inicial;
    let receitaItems = [];

    function showTab(tab, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + tab).classList.add('active');
        el.classList.add('active');
        renderIngs();
    }

    function maskMoney(i) {
        let v = i.value.replace(/\D/g,'');
        v = (v/100).toFixed(2).replace(".", ",");
        i.value = "R$ " + v;
    }

    function parseVal(v) { return parseFloat(v.toString().replace(",", ".")) || 0; }
    function parseMoney(v) { return parseFloat(v.replace(/[R$\s.]/g, "").replace(",", ".")) || 0; }

    function saveIng() {
        const nome = document.getElementById('in-nome').value;
        const preco = parseMoney(document.getElementById('in-preco').value);
        const peso = parseVal(document.getElementById('in-peso').value);
        const unid = document.getElementById('in-unid').value;

        if(!nome || preco <= 0) return alert("Preencha os dados!");

        db.push({ nome, preco, peso, unid });
        localStorage.setItem('pitadaFinalDB', JSON.stringify(db));
        alert("Salvo!");
        renderIngs();
    }

    function renderIngs() {
        const search = document.getElementById('search').value.toLowerCase();
        const lista = document.getElementById('lista-ing');
        const drop = document.getElementById('drop-ing');
        lista.innerHTML = "";
        drop.innerHTML = '<option value="">-- Selecione --</option>';

        db.sort((a,b) => a.nome.localeCompare(b.nome)).forEach((it, idx) => {
            if(it.nome.toLowerCase().includes(search)) {
                lista.innerHTML += `<tr><td>${it.nome}</td><td>R$ ${it.preco.toFixed(2)}</td><td>${it.peso}${it.unid}</td><td><button onclick="delIng(${idx})" style="background:red; color:white">X</button></td></tr>`;
            }
            drop.innerHTML += `<option value="${idx}">${it.nome}</option>`;
        });
    }

    function delIng(i) {
        if(confirm("Excluir?")) {
            db.splice(i, 1);
            localStorage.setItem('pitadaFinalDB', JSON.stringify(db));
            renderIngs();
        }
    }

    function resetSystem() {
        if(confirm("Isso vai resetar tudo. Prosseguir?")) {
            localStorage.setItem('pitadaFinalDB', JSON.stringify(inicial));
            location.reload();
        }
    }

    function updateUnit() {
        const idx = document.getElementById('drop-ing').value;
        document.getElementById('label-unidade').innerText = idx !== "" ? "Unidade: " + db[idx].unid : "Unidade: ---";
    }

    function addToRecipe() {
        const idx = document.getElementById('drop-ing').value;
        const qtdRaw = document.getElementById('rec-qtd').value;
        const qtd = parseVal(qtdRaw);
        
        if(idx === "" || qtd <= 0) return;

        const it = db[idx];
        let calcQtd = qtd;
        
        // REGRA DE CONVERS√ÉO: Se o item √© Kg/L e o usu√°rio digitou gramas (ex: 500)
        if((it.unid === "Kg" || it.unid === "L") && qtd >= 10) {
            calcQtd = qtd / 1000;
        }

        const custo = (it.preco / it.peso) * calcQtd;
        receitaItems.push({ nome: it.nome, qtd: qtdRaw, unid: it.unid, custo: custo });
        renderRecipe();
    }

    function renderRecipe() {
        const corpo = document.getElementById('lista-rec');
        corpo.innerHTML = "";
        let total = 0;
        receitaItems.forEach((it, i) => {
            total += it.custo;
            corpo.innerHTML += `<tr><td>${it.nome}</td><td>${it.qtd}${it.unid}</td><td>R$ ${it.custo.toFixed(2)}</td><td onclick="receitaItems.splice(${i},1);renderRecipe()" style="color:red;cursor:pointer">‚úñ</td></tr>`;
        });
        document.getElementById('total-rec').innerText = "R$ " + total.toFixed(2).replace(".",",");
    }

    renderIngs();
</script>
</body>
</html>
