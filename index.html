<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitada Doce - Sistema Bakery v6</title>
    <style>
        :root { --rosa: #d63384; --dark: #2c3e50; --fundo: #f8f9fa; --danger: #e74c3c; --warning: #f1c40f; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--fundo); }
        #sidebar { width: 220px; background: var(--dark); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .logo { padding: 25px; text-align: center; font-weight: bold; background: var(--rosa); font-size: 1.2rem; }
        .nav-item { padding: 15px 25px; cursor: pointer; border-bottom: 1px solid #3e4f5f; }
        .nav-item:hover, .nav-item.active { background: #3e4f5f; border-left: 5px solid var(--rosa); }
        #content { flex: 1; padding: 30px; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #eee; }
        h2 { color: var(--dark); margin-top: 0; font-size: 1.3rem; border-bottom: 2px solid var(--fundo); padding-bottom: 10px; }
        .form-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: flex-end; }
        label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #666; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; padding: 12px 20px; }
        .btn-add { background: var(--rosa); color: white; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px; background: #f1f3f5; color: #495057; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; }
        .total-box { background: var(--dark); color: white; padding: 25px; border-radius: 12px; text-align: right; margin-top: 20px; font-size: 1.2rem; }
        .total-box b { color: var(--rosa); font-size: 1.8rem; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="logo">Pitada Doce üßÅ</div>
    <div class="nav-item active" onclick="switchTab('ingredientes', this)">üì¶ Ingredientes</div>
    <div class="nav-item" onclick="switchTab('receitas', this)">üéÇ Receitas</div>
</div>

<div id="content">
    <div id="tab-ingredientes" class="tab-content active">
        <div class="card">
            <h2 id="form-title">Gerenciar Insumos</h2>
            <input type="hidden" id="edit-id" value="-1">
            <div class="form-row">
                <div style="flex: 2;">
                    <label>Nome</label>
                    <input type="text" id="in-nome">
                </div>
                <div style="flex: 1.2;">
                    <label>Pre√ßo Pago</label>
                    <input type="text" id="in-preco" oninput="maskBRL(this)">
                </div>
                <div style="flex: 0.8;">
                    <label>Peso/Qtd</label>
                    <input type="number" id="in-peso" step="any">
                </div>
                <div style="flex: 0.8;">
                    <label>Unidade</label>
                    <select id="in-unid">
                        <option value="g">g</option><option value="Kg">Kg</option>
                        <option value="ML">ML</option><option value="L">L</option>
                        <option value="un">un</option>
                    </select>
                </div>
            </div>
            <button class="btn-add" onclick="handleSave()">üíæ SALVAR NO BANCO DE DADOS</button>
            <button id="btn-cancel" style="display:none; width:100%; margin-top:10px; background:#ccc;" onclick="resetForm()">Cancelar</button>
        </div>

        <div class="card">
            <input type="text" id="search-input" placeholder="üîé Pesquisar ingrediente..." oninput="currentPage=1; renderIngs();" style="margin-bottom:15px">
            <table>
                <thead><tr><th>Nome</th><th>Pre√ßo</th><th>Medida</th><th>A√ß√µes</th></tr></thead>
                <tbody id="lista-corpo"></tbody>
            </table>
            <div class="pagination">
                <button onclick="changePage(-1)">‚óÄ Anterior</button>
                <span id="pageInfo">P√°gina 1</span>
                <button onclick="changePage(1)">Pr√≥ximo ‚ñ∂</button>
            </div>
            <hr style="margin-top:20px; opacity:0.2">
            <button onclick="forcarCarga()" style="background:#0d6efd; color:white; width:100%; font-size:0.8rem">üîÑ FOR√áAR CARREGAMENTO DA PLANILHA (Use se a lista sumir)</button>
        </div>
    </div>

    <div id="tab-receitas" class="tab-content">
        <div class="card">
            <h2>Calculadora de Receita</h2>
            <div class="form-row">
                <div style="flex: 2;">
                    <label>Ingrediente</label>
                    <select id="rec-drop" onchange="updateRecipeUnit()"></select>
                </div>
                <div style="flex: 1;">
                    <label>Qtd Usada (<span id="unit-label">---</span>)</label>
                    <input type="number" id="rec-qtd-usada">
                </div>
                <div style="flex: 0.5;">
                    <button style="background: var(--dark); color:white; width:100%" onclick="addToRecipe()">+ ADD</button>
                </div>
            </div>
            <table>
                <thead><tr><th>Item</th><th>Uso</th><th>Custo</th><th></th></tr></thead>
                <tbody id="rec-list"></tbody>
            </table>
            <div class="total-box">Custo Total: <b id="rec-total">R$ 0,00</b></div>
            <button onclick="recipeItems=[]; renderRecipe();" style="background:none; color:#999; font-size:0.8rem">LIMPAR TUDO</button>
        </div>
    </div>
</div>

<script>
    const planilhaOriginal = [{"nome":"A√ß√∫car Cristal","preco":5.49,"peso":1,"unid":"Kg"},{"nome":"Chocolate Melken Meio Amargo","preco":159.99,"peso":2.005,"unid":"Kg"},{"nome":"Leite condensado","preco":9.99,"peso":395,"unid":"g"},{"nome":"Manteiga","preco":14.99,"peso":200,"unid":"g"},{"nome":"Ovos","preco":25.00,"peso":30,"unid":"un"},{"nome":"Farinha de Trigo","preco":6.99,"peso":1,"unid":"Kg"},{"nome":"Nutella","preco":190.00,"peso":3,"unid":"Kg"},{"nome":"Cacau em P√≥ 100%","preco":44.99,"peso":500,"unid":"g"},{"nome":"Colher descartavel","preco":29.90,"peso":50,"unid":"un"},{"nome":"Creme de Leite","preco":4.19,"peso":200,"unid":"g"},{"nome":"Uva","preco":13.99,"peso":500,"unid":"g"},{"nome":"Pistache cremoso","preco":65.30,"peso":585,"unid":"g"}];

    let db = JSON.parse(localStorage.getItem('pitadaDataV6')) || planilhaOriginal;
    let recipeItems = [];
    let currentPage = 1;
    const itemsPerPage = 10;

    function switchTab(tabId, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        el.classList.add('active');
        renderIngs();
    }

    function maskBRL(i) {
        let v = i.value.replace(/\D/g,'');
        v = (v/100).toFixed(2).replace(".", ",");
        v = v.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
        v = v.replace(/(\d)(\d{3}),/g, "$1.$2,");
        i.value = "R$ " + v;
    }

    function parseBRL(v) {
        return parseFloat(v.replace(/[R$\s.]/g, "").replace(",", ".")) || 0;
    }

    function handleSave() {
        const nome = document.getElementById('in-nome').value;
        const preco = parseBRL(document.getElementById('in-preco').value);
        const peso = parseFloat(document.getElementById('in-peso').value);
        const unid = document.getElementById('in-unid').value;
        const editId = parseInt(document.getElementById('edit-id').value);

        if(!nome || preco <= 0 || !peso) return alert("Preencha os campos!");

        if(editId > -1) {
            if(confirm("Confirmar edi√ß√£o?")) db[editId] = { nome, preco, peso, unid };
        } else {
            db.push({ nome, preco, peso, unid });
        }
        localStorage.setItem('pitadaDataV6', JSON.stringify(db));
        resetForm();
        renderIngs();
    }

    function renderIngs() {
        const search = document.getElementById('search-input').value.toLowerCase();
        const filtered = db.filter(i => i.nome.toLowerCase().includes(search)).sort((a,b) => a.nome.localeCompare(b.nome));
        
        const totalPages = Math.ceil(filtered.length / itemsPerPage) || 1;
        const start = (currentPage - 1) * itemsPerPage;
        const pageData = filtered.slice(start, start + itemsPerPage);

        const corpo = document.getElementById('lista-corpo');
        corpo.innerHTML = "";
        pageData.forEach(item => {
            const realIdx = db.findIndex(i => i.nome === item.nome);
            corpo.innerHTML += `<tr>
                <td><b>${item.nome}</b></td>
                <td>R$ ${item.preco.toFixed(2)}</td>
                <td>${item.peso}${item.unid}</td>
                <td>
                    <button class="btn-edit" onclick="startEdit(${realIdx})">Editar</button>
                    <button class="btn-del" style="background:var(--danger);color:white;padding:6px" onclick="handleDel(${realIdx})">X</button>
                </td>
            </tr>`;
        });

        document.getElementById('pageInfo').innerText = `P√°gina ${currentPage} de ${totalPages}`;
        
        // Dropdown Receita
        const drop = document.getElementById('rec-drop');
        drop.innerHTML = '<option value="">-- Selecione --</option>';
        db.sort((a,b) => a.nome.localeCompare(b.nome)).forEach(item => {
            drop.innerHTML += `<option value="${db.indexOf(item)}">${item.nome}</option>`;
        });
    }

    function changePage(dir) { currentPage += dir; renderIngs(); }

    function handleDel(idx) {
        if(confirm("Excluir " + db[idx].nome + "?")) {
            db.splice(idx, 1);
            localStorage.setItem('pitadaDataV6', JSON.stringify(db));
            renderIngs();
        }
    }

    function startEdit(idx) {
        const it = db[idx];
        document.getElementById('edit-id').value = idx;
        document.getElementById('in-nome').value = it.nome;
        document.getElementById('in-preco').value = "R$ " + it.preco.toFixed(2).replace(".",",");
        document.getElementById('in-peso').value = it.peso;
        document.getElementById('in-unid').value = it.unid;
        document.getElementById('form-title').innerText = "üìù Editando: " + it.nome;
        document.getElementById('btn-cancel').style.display = "block";
    }

    function resetForm() {
        document.getElementById('edit-id').value = "-1";
        document.getElementById('in-nome').value = "";
        document.getElementById('in-preco').value = "";
        document.getElementById('in-peso').value = "";
        document.getElementById('form-title').innerText = "Gerenciar Insumos";
        document.getElementById('btn-cancel').style.display = "none";
    }

    function forcarCarga() {
        if(confirm("Isso ir√° resetar sua lista para os ingredientes da planilha. Deseja continuar?")) {
            localStorage.setItem('pitadaDataV6', JSON.stringify(planilhaOriginal));
            db = planilhaOriginal;
            renderIngs();
        }
    }

    function updateRecipeUnit() {
        const idx = document.getElementById('rec-drop').value;
        document.getElementById('unit-label').innerText = idx !== "" ? db[idx].unid : "---";
    }

    function addToRecipe() {
        const idx = document.getElementById('rec-drop').value;
        const qtd = parseFloat(document.getElementById('rec-qtd-usada').value);
        if(idx === "" || !qtd) return;
        const it = db[idx];
        let divisor = it.peso;
        if(it.unid === "Kg" || it.unid === "L") divisor = it.peso * 1000;
        const custo = (it.preco / divisor) * qtd;
        recipeItems.push({ nome: it.nome, qtd, unid: it.unid, custo });
        renderRecipe();
    }

    function renderRecipe() {
        const corpo = document.getElementById('rec-list');
        corpo.innerHTML = "";
        let total = 0;
        recipeItems.forEach((it, i) => {
            total += it.custo;
            corpo.innerHTML += `<tr><td>${it.nome}</td><td>${it.qtd}${it.unid}</td><td>R$ ${it.custo.toFixed(2)}</td><td onclick="recipeItems.splice(${i},1);renderRecipe()" style="color:red;cursor:pointer">‚úñ</td></tr>`;
        });
        document.getElementById('rec-total').innerText = "R$ " + total.toFixed(2);
    }

    renderIngs();
</script>
</body>
</html>
